#Песочница TINKOFF INVEST API

##Адреса сервиса TINKOFF INVEST API Sandbox

Для работы с песочницей существуют два способа:

1. Все вызовы сервиса песочницы выполняются по адресу **`sandbox-invest-public-api.tinkoff.ru:443`**.
2. Пользоваться методами Sandbox-сервиса.

**Команда TINKOFF INVEST API рекомендует пользоваться первым способом**.

Различия работы контуров описаны на [странице](/investAPI/url_difference/).

##Методы по работе со счетами песочницы. 

Для тестирования своего торгового робота в песочнице можно использовать неограниченное
количество счетов, которые существуют только в песочнице и не имеют отношения к реальным
торгам на бирже. 

* [OpenSandboxAccount](/investAPI/sandbox#opensandboxaccount) — метод создания специального счёта песочницы;
* [SandboxPayIn](/investAPI/sandbox#sandboxpayin) — пополнение баланса счёта песочницы;
* [CloseSandboxAccount](/investAPI/sandbox#closesandboxaccount) — метод закрытия счёта в песочнице.


Обратите внимание, что пополнение счёта песочницы возможно только в рублях. Для выполнения операций с другой валютой расчётов, следует эту валюту сперва купить c помощью метода [PostOrder](/investAPI/orders#postorder).

Для получения списка своих счетов в песочнице используется метод [getAccount](/investAPI/sandbox#getaccounts).

**Важно!** Все счета в песочнице являются виртуальными и могут быть удалены в любой
момент времени. Если созданный ранее счёт не найден, создайте, пожалуйста, новый. 
Счета хранятся 3 месяца с даты последнего использования.

**Важно!** В песочнице отсутствуют стоп-заявки, маржинальные показатели, а также не производится расчёт дополнительных показателей счёта,
ставок риска и размер гарантийного обеспечения, ликвидности портфеля.

##Методы получения состояния портфеля в песочнице

Методы получения операций и портфеля аналогичны таким же методам основных сервисов:

* [getSandboxOperations](/investAPI/sandbox#getsandboxoperations) — получение операций по счёту;
* [getSandboxPortfolio](/investAPI/sandbox#getsandboxportfolio) — получение портфолио по счёту;
* [getSandboxPositions](/investAPI/sandbox#getsandboxpositions) — получение списка позиций по счёту. 

Обратите, что для методов песочницы не рассчитываются некоторые статистические параметры
портфеля, такие как относительная и абсолютные доходности и т.п.

##Методы по работе с торговыми поручениями в песочнице

Параметры методов выставления, отмены, получения статуса торгового поручения в 
песочнице аналогичны методам основной работы с TINKOFF INVEST API. 

* [postSandboxOrder](/investAPI/sandbox#postsandboxorder) — выставление торгового поручения;
* [getSandboxOrderState](/investAPI/sandbox#getsandboxorderstate) — получение статуса торгового поручения;
* [cancelSandboxOrder](/investAPI/sandbox#cancelsandboxorder) — отмена выставленного торгового поручения;
* [getSandboxOrders](/investAPI/sandbox#getsandboxorders) — получение списка торговых поручений по счёту;


##Методы сервиса операций в песочнице
* [GetSandboxOperations](/investAPI/sandbox/#getsandboxoperations) и [GetSandboxOperationsByCursor](/investAPI/sandbox/#getsandboxoperationsbycursor) 
в `OperationType` поддерживают фильтрацию только по типам `OPERATION_TYPE_BUY` и `OPERATION_TYPE_SELL`.



* [GetDividendsForeignIssuer](/investAPI/sandbox#getdividendsforeignissuer) - получение отчёта "Справка о доходах за пределами РФ";  
Обращаем ваше внимание, что в данном методе песочницы всегда будет возвращаться пустой ответ:
```
"div_foreign_issuer_report": {     
        "dividends_foreign_issuer_report": [],
        "itemsCount": 0,     
        "pagesCount": 0,     
        "page": 0   
},
"payload": "div_foreign_issuer_report"
```
* [GetBrokerReport](/investAPI/sandbox#getbrokerreport) - получение брокерского отчёта;  
Обращаем ваше внимание, что в данном методе песочницы всегда будет возвращаться пустой ответ:
```
"get_broker_report_response": {
    "broker_report": [],
    "itemsCount": 0,     
    "pagesCount": 0,     
    "page": 0
},
"payload": "get_broker_report_response"
```
* [PortfolioStream](/investAPI/sandbox#portfoliostream) - server-side stream обновлений портфеля;
* [PositionsStream](/investAPI/sandbox#positionsstream) - server-side stream обновлений информации по изменению позиций портфеля;
* [GetPortfolio](/investAPI/sandbox#getportfolio) - получение портфеля по счёту.

##Методы сервиса ордеров в песочнице
* [TradesStream](/investAPI/sandbox#tradesstream) - получение портфеля по счёту.

##Методы сервиса cчетов в песочнице
* [GetMarginAttributes](/investAPI/sandbox#getmarginattributes) - получение портфеля по счёту. Обращаем ваше внимание, что в данном методе песочницы будут возвращены: 
  * значение параметра liquid_portfolio (ликвидной стоимости портфеля) = стоимости портфеля. 
  * starting_margin  = corrected_margin = minimal_margin = amount_of_missing_funds = 0
  * funds_sufficiency_level = 2

<a name="orderexecute"></a>


### Особенности торгов в "Песочнице"

Мы старались сделать контур, на котором проводится тестирование, приближенным к реальному продуктовому,
тем не менее он имеет ряд особенностей. Ниже приведены наиболее важные из них:

1. Для всех клиентов открыты все инструменты, в том числе те, которые предназначены для квалифицированных инвесторов, не нужно проходить тестирование или получать статус квалифицированного инвестора.
2. Открыта маржинальная торговля и короткие позиции. При этом сделан упрощенный расчет ликвидности портфеля. Для всех участников по всем инструментам "плечо" в обе стороны(покупка или продажа) равно 2.
**Пример:** При первоначальном балансе 1000 рублей возможно купить или продать активы на 2000 рублей.
Торговля с плечом(маржинальная торговля) не увеличивает первоначальный баланс и это можно использовать для улучшения доходности стратегии.
3. При торговле фьючерсами в случае покупки со счета списывается **полная стоимость**, а не гарантийное обеспечении (ГО), 
как при торговле на Московской бирже, в случае продажи начисляется полная стоимость. Вариационная маржа не рассчитывается.
4. Если были выплаты купонов или дивидендов, то начисления по таким выплатам произведены **не будут**.
5. В случае экспирации фьючерсных контрактов, поставка базовых активов или начисление денег также не производится.
6. Налоги не рассчитываются.
7. Комиссия считается в размере 0,05% от объема сделки, независимо от инструмента.


###Алгоритм исполнения торговых поручений в песочнице


Алгоритм исполнения торговых поручений в песочнице отличается от "боевого" алгоритма. 
Также следует обязательно учитывать, что в песочнице полностью отсутствует влияние
совершаемых сделок на рынок.

1. Рыночные(market) ордера иcполняются по цене последней сделки (last price).
2. Выставленные заявки не оказывают влияния на рынок. **Пример:** рыночные заявки на 1 лот и на 10 000 лотов будут исполнены по одинаковой цене,
даже если в "стакане" по этой цене не было достаточного количество встречных предложений. 
3. При выставлении лимитного ордера проверяется цена в "стакане": при наличии встречного предложения **хотя бы на 1 лот из всего объема** ордер будет **исполнен полностью** по цене лучшего встречного предложения.
4. Если лимитный ордер не может исполнится в момент выставления, он встает в рынок и ожидает появления предложений. При этом ордер не участвует в формировании "стакана".
5. При выставлении торгового поручения со счёта песочницы блокируются активы(при продаже) или денежные средства(при покупке). 
**Операции при этом появятся только при исполнении торгового поручения**.
6. Сервис получает от торговых площадок информацию о последних сделках по всем инструментам и исполняет активные заявки. 
</br>Например, существует заявка на покупку акции по цене 100 руб.; если цена инструмента в последней сделке с биржи равна 100 или менее
рублей, то заявка исполняется **по цене, которая была в ней указана** (т.е. по 100 руб).
</br>Если же заявка на продажу, то она исполнится, когда цена последней сделки будет 100 или более
рублей.
7. Все неисполненные торговые поручения в песочнице отменяются после окончания торговой сессии. 
Заблокированные активы возвращаются на счёт.
